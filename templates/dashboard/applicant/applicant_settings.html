{% extends 'dashboard/applicant/applicant_dashboard_base.html' %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/dashboard/applicant/applicant_settings.css' %}">
{% endblock %}

{% block dashboard_content %}
<div >
    <div class="main-content-header">
        <h2>Setting</h2>
        <div class="settings-nav">
            <a href="#personal" data-tab="personal" class="active">
                <i class="fas fa-user"></i>Profile
            </a>
            <a href="#profile" data-tab="profile">
                <i class="fas fa-id-card"></i>Personal
            </a>
            <a href="#social" data-tab="social">
                <i class="fas fa-share-alt"></i>Social Links
            </a>
            <a href="#account" data-tab="account">
                <i class="fas fa-cog"></i>Account Setting
            </a>
        </div>
    </div>

    <!-- Personal Tab -->
    <div id="personal-tab" class="tab-content active">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="personal_info">

            <div class="basic-information">
                <h3>Basic Information</h3>
                <div class="basic-info-container">
                    <div class="form-group profile-picture">
                        <label>Profile Picture</label>
                        {% if profile.profile_image and profile.profile_image.url != '/media/defaults/default-avatar.png' %}
                        <div class="image-preview has-image" id="profile-preview" onclick="document.getElementById('{{ personal_info_form.profile_image.id_for_label }}').click()">
                            <img src="{{ profile.profile_image.url }}" alt="Profile Picture">
                            <div class="hover-overlay">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><span>Browse photo</span> or drop here</p>
                                <small>Max photo size 5 MB</small>
                            </div>
                        </div>
                        {% else %}
                        <div class="empty-state-box" onclick="document.getElementById('{{ personal_info_form.profile_image.id_for_label }}').click()">
                            <i class="fas fa-user-circle"></i>
                            <p>No profile picture uploaded yet</p>
                            <button type="button" class="btn-upload-empty">
                                <i class="fas fa-upload"></i> Upload Photo
                            </button>
                        </div>
                        {% endif %}
                        <!-- Render hidden file input for profile image so JS can trigger it -->
                        <div style="display:none;">
                            {{ personal_info_form.profile_image }}
                        </div>
                    </div>
                    <div class="form-group-wrapper">
                        <div class="form-group">
                            <label for="{{ personal_info_form.title.id_for_label }}">Title/headline</label>
                                {{ personal_info_form.title }}
                            {% if personal_info_form.title.errors %}
                                <div class="error-text">{{ personal_info_form.title.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-row-three-columns">
                            <div class="form-group">
                                <label for="{{ personal_info_form.first_name.id_for_label }}">First Name</label>
                                {{ personal_info_form.first_name }}
                                {% if personal_info_form.first_name.errors %}
                                    <div class="error-text">{{ personal_info_form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="form-group">
                                <label for="{{ personal_info_form.middle_name.id_for_label }}">Middle Name (Optional)</label>
                                {{ personal_info_form.middle_name }}
                            </div>
                            <div class="form-group">
                                <label for="{{ personal_info_form.last_name.id_for_label }}">Last Name</label>
                                {{ personal_info_form.last_name }}
                                {% if personal_info_form.last_name.errors %}
                                    <div class="error-text">{{ personal_info_form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="form-row-two-columns">
                            <div class="form-group">
                                <label for="{{ personal_info_form.experience.id_for_label }}">Experience</label>
                                {{ personal_info_form.experience }}
                                {% if personal_info_form.experience.errors %}
                                    <div class="error-text">{{ personal_info_form.experience.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="form-group">
                                <label for="{{ personal_info_form.education_level.id_for_label }}">Education Level</label>
                                        {{ personal_info_form.education_level }}
                                        {% if personal_info_form.education_level.errors %}
                                            <div class="error-text">{{ personal_info_form.education_level.errors.0 }}</div>
                                        {% endif %}
                            </div>
                        </div>
                        <button type="submit" class="btn-save">Save Changes</button>
                    </div>
                </div>

            </div>
        </form>

       <div class="cv-resume-section">
           <h3>Your CV/Resume</h3>
            <div class="resume-list">

                {% if resumes %}
                    {% for resume in resumes %}
                    <!-- make the whole card clickable to open the file; stopPropagation on the delete form -->
                    <div
                        class="resume-card resume-clickable"
                        role="button"
                        aria-pressed="false"
                        data-resume-id="{{ resume.id }}"
                        onclick="openResumeFile(event, '{{ resume.file.url }}')"
                        onkeydown="if(event.key === 'Enter') openResumeFile(event, '{{ resume.file.url }}')"
                    >

                        <i class="fas fa-file-pdf"></i>

                        <div class="resume-info">
                            <p class="resume-title">{{ resume.name }}</p>
                            <small class="resume-size">
                                {{ resume.file.size|filesizeformat }} • Uploaded {{ resume.uploaded_at|date:"M d, Y" }}
                            </small>

                            {% if resume.is_default %}
                                <span class="default-badge">
                                    <i class="fas fa-star"></i> DEFAULT
                                </span>
                            {% endif %}
                        </div>

                        <!-- ⭐ INSTANT DELETE BUTTON (replaces 3-dots menu)
                             stopPropagation so clicking trash won't open the resume -->
                        <form method="post"
                              action="{% url 'dashboard:applicant_settings' %}"
                              class="resume-delete-form"
                              onsubmit="return confirmDeleteResume(event, '{{ resume.name|escapejs }}')"
                              onclick="event.stopPropagation()">

                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="resume_delete">
                            <input type="hidden" name="resume_id" value="{{ resume.id }}">

                            <button type="submit" class="btn-icon-action delete-btn" title="Delete Resume" aria-label="Delete {{ resume.name }}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>

                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-resume-state">
                        <i class="fas fa-file-alt"></i>
                        <p>No resumes uploaded yet</p>
                        <small>Upload your first resume to start applying for jobs</small>
                    </div>
                {% endif %}

                <!-- Add Resume Box -->
                <div class="add-resume-card" onclick="openResumeModal()" role="button" tabindex="0">
                    <i class="fas fa-plus-circle"></i>
                    <div class="add-resume-card-info">
                        <p class="add-title">Add CV/Resume</p>
                        <small class="add-hint">PDF, DOC, or DOCX (max 5MB)</small>
                    </div>
                </div>
            </div>
        </div>


        <!-- Resume Upload Modal -->
        <div class="modal" id="resumeModal">
            <div class="modal-overlay" onclick="closeResumeModal()"></div>
            <div class="modal-content">
                <button type="button" class="modal-close" onclick="closeResumeModal()">
                    <i class="fas fa-times"></i>
                </button>

                <h2 class="modal-title">Add CV/Resume</h2>

                <form method="post" enctype="multipart/form-data" id="resumeForm" action="{% url 'dashboard:applicant_settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="resume_upload">

                    <div class="modal-form-group">
                        <label for="id_name">
                            Resume Name <span class="required">*</span>
                        </label>
                        <input
                            type="text"
                            id="id_name"
                            name="name"
                            class="modal-input"
                            placeholder="e.g., Software Developer Resume 2024"
                            required
                            maxlength="255"
                        >
                        <small class="field-hint">Give your resume a descriptive name to easily identify it</small>
                    </div>

                    <div class="modal-form-group">
                        <label>Upload your CV/Resume <span class="required">*</span></label>
                        <div class="modal-upload-area" id="uploadArea">
                            <div class="upload-prompt" id="uploadPrompt">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><strong>Click to browse</strong> or drag and drop</p>
                                <small>PDF, DOC, or DOCX • Max file size 5 MB</small>
                            </div>
                            <div class="file-attached" id="fileAttached" style="display: none;">
                                <i class="fas fa-file-pdf"></i>
                                <div class="file-details">
                                    <p class="file-name" id="attachedFileName"></p>
                                    <small class="file-size" id="attachedFileSize"></small>
                                </div>
                                <button type="button" class="remove-file-btn" onclick="removeFile(event)">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <input
                            type="file"
                            id="id_file"
                            name="file"
                            style="display: none;"
                            accept=".pdf,.doc,.docx"
                            required
                        >
                        <div class="error-message" id="fileError"></div>
                    </div>

                    <div class="modal-form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="id_is_default" name="is_default" {% if not resumes %}checked{% endif %}>
                            <span>Set as default resume</span>
                        </label>
                        <small class="field-hint">This resume will be automatically selected when applying for jobs</small>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" onclick="closeResumeModal()">Cancel</button>
                        <button type="submit" class="btn-submit" id="submitResumeBtn">
                            <i class="fas fa-upload"></i> Upload Resume
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Resume Confirmation Modal -->
        <div class="modal" id="deleteResumeModal">
            <div class="modal-overlay" onclick="closeDeleteResumeModal()"></div>
            <div class="modal-content delete-confirm-modal">
                <button type="button" class="modal-close" onclick="closeDeleteResumeModal()">
                    <i class="fas fa-times"></i>
                </button>

                <div class="delete-modal-header">
                    <i class="fas fa-exclamation-circle"></i>
                    <h2>Delete Resume?</h2>
                </div>

                <div class="delete-modal-body">
                    <p>Are you sure you want to delete <strong id="deleteResumeName"></strong>?</p>
                    <p class="text-muted">This action cannot be undone. Any job applications using this resume will still retain their copy.</p>

                    <form method="post" id="deleteResumeForm" action="{% url 'dashboard:applicant_settings' %}">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="resume_delete">
                        <input type="hidden" name="resume_id" id="deleteResumeId">

                        <div class="modal-actions">
                            <button type="button" class="btn-cancel" onclick="closeDeleteResumeModal()">Cancel</button>
                            <button type="submit" class="btn-delete-confirm">
                                <i class="fas fa-trash"></i> Delete Resume
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Tab -->
    <div class="tab-content" id="profile-tab">
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="profile_details">

            <div class="profile-form-section">
                <h3>Personal Details</h3>

                <div class="form-row-two-columns">
                    <div class="form-group">
                        <label for="{{ profile_details_form.nationality.id_for_label }}">Nationality</label>
                        {{ profile_details_form.nationality }}
                        {% if profile_details_form.nationality.errors %}
                            <div class="error-text">{{ profile_details_form.nationality.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ profile_details_form.date_of_birth.id_for_label }}">Date of Birth</label>
                        {{ profile_details_form.date_of_birth }}
                        {% if profile_details_form.date_of_birth.errors %}
                            <div class="error-text">{{ profile_details_form.date_of_birth.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row-two-columns">
                    <div class="form-group">
                        <label for="{{ profile_details_form.gender.id_for_label }}">Gender</label>
                        {{ profile_details_form.gender }}
                        {% if profile_details_form.gender.errors %}
                            <div class="error-text">{{ profile_details_form.gender.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ profile_details_form.marital_status.id_for_label }}">Marital Status</label>
                        {{ profile_details_form.marital_status }}
                        {% if profile_details_form.marital_status.errors %}
                            <div class="error-text">{{ profile_details_form.marital_status.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="form-row-three-columns">
                    <div class="form-group">
                        <label for="{{ profile_details_form.location_street.id_for_label }}">Street Address</label>
                        {{ profile_details_form.location_street }}
                        {% if profile_details_form.location_street.errors %}
                            <div class="error-text">{{ profile_details_form.location_street.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ profile_details_form.location_city.id_for_label }}">City</label>
                        {{ profile_details_form.location_city }}
                        {% if profile_details_form.location_city.errors %}
                            <div class="error-text">{{ profile_details_form.location_city.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ profile_details_form.location_country.id_for_label }}">Country</label>
                        {{ profile_details_form.location_country }}
                        {% if profile_details_form.location_country.errors %}
                            <div class="error-text">{{ profile_details_form.location_country.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-group">
                    <label for="{{ profile_details_form.biography.id_for_label }}">Biography</label>
                    {{ profile_details_form.biography }}
                    {% if profile_details_form.biography.errors %}
                        <div class="error-text">{{ profile_details_form.biography.errors.0 }}</div>
                    {% endif %}
                </div>

                <button type="submit" class="btn-save">Save Changes</button>
            </div>
        </form>
    </div>

    <!-- Social Links Tab -->
    <div class="tab-content" id="social-tab">
        <form method="post" id="social-links-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="social_links_bulk">

            <div class="social-links-form-section">
                <div id="social-links-list">
                    {% if social_links %}
                        {% for link in social_links %}
                        <div class="social-link-item" data-link-id="{{ link.id }}">
                            <div class="social-link-input-group">
                                <select name="platform[]" class="social-platform-select">
                                    {% for value, label in social_link_form.fields.platform.choices %}
                                        <option value="{{ value }}" {% if link.platform == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                                <input type="url" name="url[]" value="{{ link.url }}" placeholder="Profile link/url..." class="social-link-input">
                                <input type="hidden" name="link_id[]" value="{{ link.id }}">
                                <button type="button" class="btn-icon-action btn-delete-link" data-action="delete-link" title="Delete">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="empty-social-message">No social links added yet. Click the button below to add your first social link.</p>
                    {% endif %}
                </div>

                <div id="add-social-link-form" class="social-link-form {% if not show_add_form %}is-hidden{% endif %}">
                    <div class="social-link-item new-link-item">
                        <div class="social-link-input-group">
                            <select id="new-platform" class="social-platform-select">
                                {% for value, label in social_link_form.fields.platform.choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                            <input type="url" id="new-url" placeholder="Profile link/url..." class="social-link-input">
                            <button type="button" class="btn-icon-action btn-confirm-add" data-action="confirm-add" title="Add">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn-icon-action btn-cancel-add" data-action="cancel-add-social-link" title="Cancel">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-add-social-link {% if show_add_form %}is-hidden{% endif %}" data-action="show-add-social-link">
                    <i class="fas fa-plus-circle"></i> Add New Social Link
                </button>

                <button type="submit" class="btn-save is-hidden" id="save-social-changes">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </form>
    </div>

    <div class="tab-content" id="account-tab">
        <div class="account-settings-section">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="contact_info">

                <div class="account-section-block">
                    <h3>Contact Info</h3>
                    <div class="form-row-two-columns">
                        <div class="form-group">
                            <label for="{{ contact_info_form.contact_number.id_for_label }}">Phone</label>
                            {{ contact_info_form.contact_number }}
                            {% if contact_info_form.contact_number.errors %}
                                <div class="error-text">{{ contact_info_form.contact_number.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ contact_info_form.email.id_for_label }}">Email</label>
                            {{ contact_info_form.email }}
                            {% if contact_info_form.email.errors %}
                                <div class="error-text">{{ contact_info_form.email.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>
            <hr>
            <form method="post" id="notification-form">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="notification_preferences">

                <div class="account-section-block">
                    <h3>Notification Preferences</h3>
                    <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Choose how you want to be notified about important updates.</p>
                    <div class="notification-checkboxes">
                        <div class="checkbox-item">
                            <input type="checkbox" id="notify-shortlisted" name="notify_shortlisted" {% if notification_prefs.notify_shortlisted %}checked{% endif %}>
                            <label for="notify-shortlisted">Notify me when employers shortlist me</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="notify-applications" name="notify_applications" {% if notification_prefs.notify_applications %}checked{% endif %}>
                            <label for="notify-applications">Notify me when my application status changes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="notify-job-alerts" name="notify_job_alerts" {% if notification_prefs.notify_job_alerts %}checked{% endif %}>
                            <label for="notify-job-alerts">Notify me about new job alerts matching my preferences</label>
                        </div>
                    </div>
                    <button type="submit" class="btn-save" style="margin-top: 15px;">Save Notification Preferences</button>
                </div>
            </form>
            <hr>
            <div class="account-section-block">
                <h3>Job Alerts</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Manage your job alert preferences and receive notifications when new jobs match your criteria.</p>
                <a href="{% url 'dashboard:applicant_job_alerts' %}" class="btn-save" style="display: inline-block; text-decoration: none; text-align: center;">
                    <i class="fas fa-bell"></i> Manage Job Alerts
                </a>
            </div>
            <hr>
            <form method="post" id="privacy-form">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="profile_privacy">

                <div class="account-section-block">
                    <h3>Profile Privacy</h3>
                    <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Control who can view your profile information.</p>
                    <div class="privacy-toggle-row">
                        <div class="privacy-info">
                            <label class="toggle-label">
                                {{ profile_privacy_form.is_public }}
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="privacy-status">{{ profile.is_public|yesno:"Public,Private" }}</span>
                        </div>
                        <span class="privacy-description">Your profile is currently <strong>{{ profile.is_public|yesno:"public,private" }}</strong>. {% if profile.is_public %}Employers can view your profile.{% else %}Only you can view your profile.{% endif %}</span>
                    </div>
                    <button type="submit" class="btn-save" id="privacy-save-btn" style="margin-top: 15px;">Save Privacy Settings</button>
                </div>
            </form>
            <hr>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="change_password">

                <div class="account-section-block">
                    <h3>Change Password</h3>
                    <div class="form-row-three-columns">
                        <div class="form-group">
                            <label for="{{ password_form.old_password.id_for_label }}">Current Password</label>
                            <div class="input-with-icon">
                                {{ password_form.old_password }}
                                <i class="fas fa-eye toggle-password"></i>
                            </div>
                            {% if password_form.old_password.errors %}
                                <div class="error-text">{{ password_form.old_password.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ password_form.new_password1.id_for_label }}">New Password</label>
                            <div class="input-with-icon">
                                {{ password_form.new_password1 }}
                                <i class="fas fa-eye toggle-password"></i>
                            </div>
                            {% if password_form.new_password1.errors %}
                                <div class="error-text">{{ password_form.new_password1.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ password_form.new_password2.id_for_label }}">Confirm Password</label>
                            <div class="input-with-icon">
                                {{ password_form.new_password2 }}
                                <i class="fas fa-eye toggle-password"></i>
                            </div>
                            {% if password_form.new_password2.errors %}
                                <div class="error-text">{{ password_form.new_password2.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>
            <hr>
            <div class="account-section-block delete-account-section">
                <h3>Delete Your Account</h3>
                <p class="delete-warning">If you delete your JobConnect account, you will no longer be able to get information about matched jobs, following employers, and job alerts. This action is <strong>permanent and cannot be undone</strong>.</p>
                <button type="button" class="btn-delete-account" id="delete-account-btn">
                    <i class="fas fa-exclamation-triangle"></i> Delete Account
                </button>
            </div>

            <!-- Delete Account Confirmation Modal -->
            <div class="modal" id="deleteAccountModal">
                <div class="modal-overlay" onclick="closeDeleteAccountModal()"></div>
                <div class="modal-content delete-confirm-modal">
                    <button type="button" class="modal-close" onclick="closeDeleteAccountModal()">
                        <i class="fas fa-times"></i>
                    </button>

                    <div class="delete-modal-header">
                        <i class="fas fa-exclamation-circle"></i>
                        <h2>Delete Account?</h2>
                    </div>

                    <div class="delete-modal-body">
                        <p>Are you absolutely sure you want to delete your account? This will:</p>
                        <ul>
                            <li>Permanently delete your profile and all personal information</li>
                            <li>Remove all your job applications</li>
                            <li>Delete your saved jobs and job alerts</li>
                            <li>Cancel any ongoing application processes</li>
                        </ul>
                        <p><strong>This action cannot be undone!</strong></p>

                        <form method="post" id="deleteAccountForm">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="delete_account">

                            <div class="form-group" style="margin-top: 20px;">
                                <label for="delete-confirm-text">Type <strong>DELETE</strong> to confirm:</label>
                                <input type="text" id="delete-confirm-text" class="form-control" placeholder="Type DELETE" autocomplete="off" required>
                            </div>

                            <div class="form-group">
                                <label for="delete-password">Enter your password to confirm:</label>
                                <div class="input-with-icon">
                                    <input type="password" id="delete-password" name="password" class="form-control" placeholder="Your password" required>
                                    <i class="fas fa-eye toggle-password"></i>
                                </div>
                            </div>

                            <div class="modal-actions">
                                <button type="button" class="btn-cancel" onclick="closeDeleteAccountModal()">Cancel</button>
                                <button type="submit" class="btn-delete-confirm" id="confirm-delete-btn" disabled>
                                    <i class="fas fa-trash"></i> Delete My Account
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Load applicant settings UI-only script (validation is server-side) -->
<script src="{% static 'js/dashboard/applicant/applicant_settings.js' %}"></script>

<script>
/**
 * Open resume file in new tab when clicking the resume card.
 * If the user clicked on a child element that belongs to the delete form,
 * the form has stopPropagation() on click so it won't reach here.
 */
function openResumeFile(evt, url) {
    try {
        // Safety: if clicked element is inside a form.delete, don't open
        if (evt && evt.target && evt.target.closest && evt.target.closest('.resume-delete-form')) {
            return;
        }
    } catch (e) {
        // ignore
    }

    // Open in new tab
    window.open(url, '_blank');
}

/**
 * Confirmation helper for delete resume actions.
 * Called by onsubmit of the delete form.
 */
function confirmDeleteResume(evt, resumeName) {
    const ok = confirm(
        'Are you sure you want to delete "' + resumeName + '"?\nThis action cannot be undone.'
    );
    if (!ok) {
        evt.preventDefault();
        return false;
    }
    return true;
}
</script>

{% endblock %}