{% extends 'dashboard/applicant/applicant_dashboard_base.html' %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/dashboard/applicant/applicant_settings.css' %}">
{% endblock %}

{% block dashboard_content %}
{% if messages %}
<div class="messages-container">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div >
    <div class="settings-header">
        <h2>Settings</h2>
        <div class="settings-nav">
            <a href="#personal" data-tab="personal" class="active">Personal</a>
            <a href="#profile" data-tab="profile" >Profile</a>
            <a href="#social" data-tab="social">Social Links</a>
            <a href="#account" data-tab="account">Account Setting</a>
        </div>
    </div>

    <!-- Personal Tab -->
    <div class="settings-content" id="personal-tab" >
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="personal_info">
            
            <div class="basic-information">
                <h3>Basic Information</h3>
                <div class="form-row">
                    <div class="form-group profile-picture">
                        <label>Profile Picture</label>
                        <div class="file-upload-area">
                            {% if profile.image and profile.image.url != '/media/defaults/default-avatar.png' %}
                            <img src="{{ profile.image.url }}" alt="Profile" style="max-width: 100px; max-height: 100px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
                            {% endif %}
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p><span>Browse photo</span> or drop here</p>
                            <small>A photo is 10x more likely to get a response. Max photo size 5 MB.</small>
                            {{ personal_info_form.image }}
                        </div>
                        {% if personal_info_form.image.errors %}
                            <div class="error-text">{{ personal_info_form.image.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group-wrapper">
                        <div class="form-group">
                            <label for="{{ personal_info_form.first_name.id_for_label }}">First Name</label>
                            {{ personal_info_form.first_name }}
                            {% if personal_info_form.first_name.errors %}
                                <div class="error-text">{{ personal_info_form.first_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ personal_info_form.middle_name.id_for_label }}">Middle Name (Optional)</label>
                            {{ personal_info_form.middle_name }}
                        </div>
                        <div class="form-group">
                            <label for="{{ personal_info_form.last_name.id_for_label }}">Last Name</label>
                            {{ personal_info_form.last_name }}
                            {% if personal_info_form.last_name.errors %}
                                <div class="error-text">{{ personal_info_form.last_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ personal_info_form.school_name.id_for_label }}">Education</label>
                            {{ personal_info_form.school_name }}
                            {% if personal_info_form.school_name.errors %}
                                <div class="error-text">{{ personal_info_form.school_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ personal_info_form.degree.id_for_label }}">Degree/Course</label>
                            {{ personal_info_form.degree }}
                            {% if personal_info_form.degree.errors %}
                                <div class="error-text">{{ personal_info_form.degree.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-save">Save Changes</button>
            </div>
        </form>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="resume">
            
            <div class="cv-resume-section">
                <h3>Your CV/Resume</h3>
                <div class="resume-list">
                    {% if profile.resume %}
                    <div class="resume-item">
                        <i class="fas fa-file-alt"></i>
                        <div class="resume-info">
                            <p>{{ profile.resume.name|slice:"28:" }}</p>
                            <small>{{ profile.resume.size|filesizeformat }}</small>
                        </div>
                        <a href="{{ profile.resume.url }}" target="_blank" class="btn-edit-resume">View Resume</a>
                    </div>
                    {% endif %}
                    <div class="add-resume-item" id="addCvBtn">
                        <i class="fas fa-plus-circle"></i>
                        <p>{{ profile.resume|yesno:"Update,Add" }} CV/Resume</p>
                        <small>Browse file or drop here, PDF/DOC/DOCX only (Max 5MB)</small>
                        {{ resume_form.resume }}
                    </div>
                    {% if resume_form.resume.errors %}
                        <div class="error-text">{{ resume_form.resume.errors.0 }}</div>
                    {% endif %}
                </div>
                <button type="submit" class="btn-save">Upload Resume</button>
            </div>
        </form>
    </div>

    <!-- Profile Tab -->
    <div class="settings-content" id="profile-tab" style="display: none;">
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="profile_details">
            
            <div class="profile-form-section">
                <div class="form-row-two-columns">
                    <div class="form-group">
                        <label for="{{ profile_details_form.location.id_for_label }}">Location</label>
                        {{ profile_details_form.location }}
                        {% if profile_details_form.location.errors %}
                            <div class="error-text">{{ profile_details_form.location.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ profile_details_form.year_level.id_for_label }}">Experience/Year Level</label>
                        {{ profile_details_form.year_level }}
                        {% if profile_details_form.year_level.errors %}
                            <div class="error-text">{{ profile_details_form.year_level.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ profile_details_form.skills_summary.id_for_label }}">Skills</label>
                    <small style="color: #6c757d; font-size: 0.875rem; display: block; margin-top: 5px;">
                        List your key technical and soft skills (e.g., Python, SQL, Communication, Teamwork)
                    </small>
                    {{ profile_details_form.skills_summary }}
                    {% if profile_details_form.skills_summary.errors %}
                        <div class="error-text">{{ profile_details_form.skills_summary.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="{{ profile_details_form.biography.id_for_label }}">Biography</label>
                    <small style="color: #6c757d; font-size: 0.875rem; display: block; margin-top: 5px;">
                        Tell employers about yourself, your experience, and career goals
                    </small>
                    {{ profile_details_form.biography }}
                    
                    {% if profile_details_form.biography.errors %}
                        <div class="error-text">{{ profile_details_form.biography.errors.0 }}</div>
                    {% endif %}
                </div>
                <button type="submit" class="btn-save">Save Changes</button>
            </div>
        </form>
    </div>

    <!-- Social Links Tab -->
    <div class="settings-content" id="social-tab" style="display: none;">
        <div class="social-links-form-section">
            {% if social_links %}
                {% for link in social_links %}
                <form method="post" class="social-link-item">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="social_link">
                    <input type="hidden" name="social_link_id" value="{{ link.id }}">
                    
                    <label>{{ link.get_platform_display }}</label>
                    <div class="social-link-input-group">
                        <select name="platform" class="social-platform-select">
                            {% for value, label in social_link_form.fields.platform.choices %}
                                <option value="{{ value }}" {% if link.platform == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        <input type="url" name="url" value="{{ link.url }}" placeholder="Profile link/url..." class="social-link-input">
                        <button type="submit" class="btn-save-link" title="Save"><i class="fas fa-check"></i></button>
                    </div>
                </form>
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="delete_social_link">
                    <input type="hidden" name="social_link_id" value="{{ link.id }}">
                    <button type="submit" class="btn-remove-link" onclick="return confirm('Are you sure you want to delete this social link?')">
                        <i class="fas fa-times-circle"></i>
                    </button>
                </form>
                {% endfor %}
            {% else %}
                <p style="color: #666; text-align: center; padding: 20px;">No social links added yet. Click the button below to add your first social link.</p>
            {% endif %}
            
            <div id="add-social-link-form" style="{% if not show_add_form %}display: none;{% endif %}">
                <form method="post" class="social-link-item">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="social_link">
                    
                    <label>New Social Link</label>
                    <div class="social-link-input-group">
                        {{ social_link_form.platform }}
                        {{ social_link_form.url }}
                        <button type="submit" class="btn-save-link"><i class="fas fa-check"></i> Save</button>
                        <button type="button" class="btn-cancel-link" onclick="document.getElementById('add-social-link-form').style.display='none'">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    {% if social_link_form.platform.errors %}
                        <div class="error-text">{{ social_link_form.platform.errors.0 }}</div>
                    {% endif %}
                    {% if social_link_form.url.errors %}
                        <div class="error-text">{{ social_link_form.url.errors.0 }}</div>
                    {% endif %}
                </form>
            </div>
            
            <button type="button" class="btn-add-social-link" onclick="document.getElementById('add-social-link-form').style.display='block'; this.style.display='none'">
                <i class="fas fa-plus-circle"></i> Add New Social Link
            </button>
        </div>
    </div>

    <div class="settings-content" id="account-tab" style="display: none;">
        <div class="account-settings-section">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="contact_info">
                
                <div class="account-section-block">
                    <h3>Contact Info</h3>
                    <div class="form-row-two-columns">
                        <div class="form-group">
                            <label for="{{ contact_info_form.contact_number.id_for_label }}">Phone</label>
                            {{ contact_info_form.contact_number }}
                            {% if contact_info_form.contact_number.errors %}
                                <div class="error-text">{{ contact_info_form.contact_number.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ contact_info_form.email.id_for_label }}">Email</label>
                            {{ contact_info_form.email }}
                            {% if contact_info_form.email.errors %}
                                <div class="error-text">{{ contact_info_form.email.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>

            <div class="account-section-block">
                <h3>Notification</h3>
                <div class="notification-checkboxes">
                    <div class="checkbox-item">
                        <input type="checkbox" id="notify-shortlisted" disabled>
                        <label for="notify-shortlisted">Notify me when employers shortlist me (Coming soon)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="notify-applications" disabled>
                        <label for="notify-applications">Notify me when my applications are open (Coming soon)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="notify-job-alerts" disabled>
                        <label for="notify-job-alerts">Notify me when I have an job alerts (Coming soon)</label>
                    </div>
                </div>
            </div>

            <div class="account-section-block">
                <h3>Job Alerts</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Coming soon - Set up automatic job alerts based on your preferences.</p>
            </div>

            <form method="post" id="privacy-form">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="profile_privacy">
                
                <div class="account-section-block">
                    <h3>Profile Privacy</h3>
                    <div class="privacy-toggle-row">
                        <div class="privacy-info">
                            <label class="toggle-label">
                                {{ profile_privacy_form.is_public }}
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="privacy-status">{{ profile.is_public|yesno:"Yes,No" }}</span>
                        </div>
                        <span class="privacy-description">Your profile is {{ profile.is_public|yesno:"public,private" }} now</span>
                    </div>
                    <button type="submit" class="btn-save" style="margin-top: 15px;">Save Privacy Settings</button>
                </div>
            </form>

            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="change_password">
                
                <div class="account-section-block">
                    <h3>Change Password</h3>
                    <div class="form-row-three-columns">
                        <div class="form-group">
                            <label for="{{ password_form.old_password.id_for_label }}">Current Password</label>
                            <div class="input-with-icon">
                                {{ password_form.old_password }}
                                <i class="fas fa-eye toggle-password"></i>
                            </div>
                            {% if password_form.old_password.errors %}
                                <div class="error-text">{{ password_form.old_password.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ password_form.new_password1.id_for_label }}">New Password</label>
                            <div class="input-with-icon">
                                {{ password_form.new_password1 }}
                                <i class="fas fa-eye toggle-password"></i>
                            </div>
                            {% if password_form.new_password1.errors %}
                                <div class="error-text">{{ password_form.new_password1.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ password_form.new_password2.id_for_label }}">Confirm Password</label>
                            <div class="input-with-icon">
                                {{ password_form.new_password2 }}
                                <i class="fas fa-eye toggle-password"></i>
                            </div>
                            {% if password_form.new_password2.errors %}
                                <div class="error-text">{{ password_form.new_password2.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>

            <div class="account-section-block delete-account-section">
                <h3>Delete Your Account</h3>
                <p class="delete-warning">If you delete your JobConnect account, you will no longer be able to get information about the matched jobs, following employers, and job alerts. You will be abandoned from all the services of JobConnect.</p>
                <button class="btn-delete-account" disabled>Close Account (Contact Admin)</button>
            </div>
        </div>
    </div>
</div>

<!-- Remove the Add CV/Resume Modal as it's no longer needed -->
{% endblock %}
