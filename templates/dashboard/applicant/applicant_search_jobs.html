{% extends 'dashboard/applicant/applicant_dashboard_base.html' %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/dashboard/applicant/applicant_search_jobs.css' %}">
{% endblock %}

{% block dashboard_content %}
<div>
    <div class="search-header">
        <h2>Find Your Dream Job</h2>
        <p>Discover opportunities that match your skills and career goals</p>
    </div>
    <div>
        <form method="get" action="{% url 'dashboard:applicant_search_jobs' %}" id="searchFilterForm">
            <div class="search-row compact">
                <div class="search-input-group">
                    <i class="fas fa-search"></i>
                    <input
                        type="text"
                        name="query"
                        value="{{ query }}"
                        placeholder="Job tittle, Keyword..."
                        class="search-input"
                    >
                </div>

                <div class="search-actions">
                    <button type="button" id="toggleFiltersBtn" class="filter-toggle" aria-expanded="false" aria-controls="filtersPanel">
                        <i class="fas fa-filter"></i>
                    </button>
                    <button type="submit" class="find-btn">Find</button>
                </div>
            </div>

            <!-- Hidden filters: shown only when the filter icon is toggled -->
            <div id="filtersPanel" class="filters-row collapsed" aria-hidden="true">
                <div class="filters-grid">
                    <select name="job_role" id="job_role" class="filter-dropdown">
                        <option value="">Category</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id|stringformat:"s" in selected_categories %}selected{% endif %}>{{ category.name }}</option>
                        {% endfor %}
                    </select>

                    <select name="education" id="education" class="filter-dropdown">
                        <option value="">Education</option>
                        {% for education in educations %}
                        <option value="{{ education.id }}" {% if education.id|stringformat:"s" in selected_educations %}selected{% endif %}>{{ education.name }}</option>
                        {% endfor %}
                    </select>

                    <select name="experience" id="experience" class="filter-dropdown">
                        <option value="">Experience</option>
                        {% for experience in experiences %}
                        <option value="{{ experience.id }}" {% if experience.id|stringformat:"s" in selected_experiences %}selected{% endif %}>{{ experience.name }}</option>
                        {% endfor %}
                    </select>

                    <select name="job_level" id="job_level" class="filter-dropdown">
                        <option value="">Level</option>
                        {% for job_level in job_levels %}
                        <option value="{{ job_level.id }}" {% if job_level.id|stringformat:"s" in selected_job_levels %}selected{% endif %}>{{ job_level.name }}</option>
                        {% endfor %}
                    </select>

                    <div class="salary-range-wrap">
                        <label for="salary_min">Salary range</label>
                        <div class="salary-inputs">
                            <input type="number" name="salary_min" id="salary_min" placeholder="Min" value="{{ request.GET.salary_min }}" class="salary-input">
                            <span class="salary-sep">—</span>
                            <input type="number" name="salary_max" id="salary_max" placeholder="Max" value="{{ request.GET.salary_max }}" class="salary-input">
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <section>
        <div class="results-header">
            {% if jobs %}
                <h3 class="results-count">
                    <span class="count-number">{{ jobs.count }}</span> job{{ jobs.count|pluralize }} found
                </h3>
                <div class="sort-options">
                    <label for="sortBy">Sort by:</label>
                    <select id="sortBy" class="sort-select">
                        <option value="recent">Most Recent</option>
                        <option value="salary-high">Salary (High to Low)</option>
                        <option value="salary-low">Salary (Low to High)</option>
                    </select>
                </div>
            {% endif %}
        </div>

        {% if jobs %}
            <table class="jobs-table">
                <thead>
                    <tr>
                        <th>Job Details</th>
                        <th>Location</th>
                        <th>Salary</th>
                        <th>Posted</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for job in jobs %}
                    <tr data-job-id="{{ job.id }}">
                        <!-- Job Info Column -->
                        <td>
                            <div class="job-info-cell">
                                <div class="job-logo">
                                    {% if job.employer.employer_profile_rel.company_profile_image %}
                                        <img src="{{ job.employer.employer_profile_rel.company_profile_image.url }}" alt="{{ job.company_name }}">
                                    {% else %}
                                        <div class="logo-placeholder">
                                            {{ job.company_name|first|upper }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="job-details">
                                    <div class="job-title">{{ job.title }}</div>
                                    <div class="company-name">{{ job.company_name }}</div>
                                    
                                </div>
                            </div>
                        </td>

                        <!-- Location Column -->
                        <td>
                            <div class="meta-info">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ job.location }}</span>
                            </div>
                        </td>

                        <!-- Salary Column -->
                        <td>
                            <div class="meta-info">
                                <i class="fas fa-money-bill-wave"></i>
                                <span class="salary-range">₱{{ job.min_salary|floatformat:0 }} - ₱{{ job.max_salary|floatformat:0 }}</span>
                            </div>
                        </td>

                        <!-- Posted Date Column -->
                        <td>
                            <div class="meta-info">
                                <i class="fas fa-clock"></i>
                                <span>{{ job.posted_at|timesince }} ago</span>
                            </div>
                        </td>

                        <!-- Actions Column -->
                        <td>
                            <div class="job-actions">
                                <a href="{% url 'jobs:job_detail' job.id %}" class="btn-action btn-view" data-job-id="{{ job.id }}">
                                    <i class="fas fa-eye"></i> View
                                </a>
                                <a href="{% url 'jobs:job_detail' job.id %}" class="btn-action btn-apply" data-job-id="{{ job.id }}">
                                    <i class="fas fa-paper-plane"></i> Apply
                                </a>
                                <button class="btn-bookmark favorite-btn {% if job.id in favorited_job_ids %}active{% endif %}" data-job-id="{{ job.id }}">
                                    <i class="{% if job.id in favorited_job_ids %}fas fa-bookmark{% else %}far fa-bookmark{% endif %}"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Pagination -->
            {% if jobs.count > 10 %}
            <div class="pagination">
                <button class="page-btn prev"><i class="fas fa-chevron-left"></i></button>
                <span class="page-numbers">
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                </span>
                <button class="page-btn next"><i class="fas fa-chevron-right"></i></button>
            </div>
            {% endif %}

        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3>No jobs found</h3>
                <p>We couldn't find any jobs matching your search criteria.</p>
                <p class="empty-suggestions">Try adjusting your filters or search terms</p>
                <a href="{% url 'dashboard:applicant_search_jobs' %}" class="btn-reset-search">
                    <i class="fas fa-redo"></i> Clear All Filters
                </a>
            </div>
        {% endif %}
    </section>
</div>

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/dashboard/applicant/applicant_search_jobs.js' %}"></script>
<script src="{% static 'js/dashboard/applicant/favorite_jobs.js' %}"></script>
{% endblock %}
{% endblock %}
