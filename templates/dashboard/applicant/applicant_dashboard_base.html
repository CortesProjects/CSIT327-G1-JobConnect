{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard/dashboard_base.css' %}">
<link rel="stylesheet" href="{% static 'css/dashboard/applicant/applicant_dashboard.css' %}">
{# optional messages CSS, will gracefully load if file exists #}
<link rel="stylesheet" href="{% static 'css/dashboard/messages.css' %}">
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/dashboard/dashboard.js' %}"></script>

<script>
/*
  Fetch unread messages count and update the badge in the sidebar.
  Uses the messages_unread_counts endpoint (dashboard:messages_unread_counts).
*/
async function fetchUnreadMessages() {
  try {
    const resp = await fetch("{% url 'dashboard:messages_unread_counts' %}");
    if (!resp.ok) return;
    const data = await resp.json();
    const badge = document.getElementById('inbox-unread-badge');
    if (!badge) return;
    const count = data.total_unread || 0;
    if (count > 0) {
      badge.textContent = count;
      badge.style.display = 'inline-block';
    } else {
      badge.textContent = '';
      badge.style.display = 'none';
    }
  } catch (err) {
    // Fail silently (console for debugging)
    console.error('Failed to fetch unread messages:', err);
  }
}

// Refresh on page load
document.addEventListener('DOMContentLoaded', function() {
  fetchUnreadMessages();
  // optional: refresh every 60 seconds
  // setInterval(fetchUnreadMessages, 60000);
});
</script>
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <aside class="dashboard-sidebar">
        <h2 class="sidebar-title">APPLICANT DASHBOARD</h2>
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="{% url 'dashboard:dashboard' %}" class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                        <i class="fas fa-layer-group"></i>
                        <span>Overview</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'dashboard:applicant_search_jobs' %}" class="{% if request.resolver_match.url_name == 'applicant_search_jobs' %}active{% endif %}">
                        <i class="fas fa-search"></i>
                        <span>Search Jobs</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'dashboard:applicant_applied_jobs' %}" class="{% if request.resolver_match.url_name == 'applicant_applied_jobs' %}active{% endif %}">
                        <i class="fas fa-briefcase"></i>
                        <span>Applied Jobs</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'dashboard:applicant_favorite_jobs' %}" class="{% if request.resolver_match.url_name == 'applicant_favorite_jobs' %}active{% endif %}">
                        <i class="fas fa-bookmark"></i>
                        <span>Favorite Jobs</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'dashboard:applicant_job_alerts' %}" class="{% if request.resolver_match.url_name == 'applicant_job_alerts' %}active{% endif %}">
                        <i class="fas fa-bell"></i>
                        <span>Job Alert</span>
                    </a>
                </li>

                {# -- Messages nav item (added) -- #}
                <li>
                    <a href="{% url 'dashboard:inbox' %}" class="{% if request.resolver_match.url_name == 'inbox' or request.resolver_match.url_name == 'conversation' or request.resolver_match.url_name == 'compose' %}active{% endif %}">
                        <i class="fas fa-envelope"></i>
                        <span>Messages</span>
                        <span id="inbox-unread-badge" class="sidebar-badge" style="display:none; margin-left:8px;"></span>
                    </a>
                </li>

                <li>
                    <a href="{% url 'dashboard:applicant_settings' %}" class="{% if request.resolver_match.url_name == 'applicant_settings' %}active{% endif %}">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <a href="{% url 'accounts:logout' %}">
                <i class="fas fa-sign-out-alt"></i>
                <span>Log-out</span>
            </a>
        </div>
    </aside>
    <div class="dashboard-main-content">
        {% block dashboard_content %}
        {% endblock %}
    </div>
</div>
{% endblock %}
