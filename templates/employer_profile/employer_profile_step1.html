{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile_setup/employer_profile_create.css' %}">
{% endblock %}

{% block title %}Employer Profile - Company Info{% endblock %}

{% block content %}


<main class="profile-setup-container">
    <div class="step-navigation-wrapper">
    <section class="step-navigation">
        <a href="{% url 'employer_profile:employer_profile_setup_step1' %}" class="step-link {% if request.resolver_match.url_name == 'employer_profile_setup_step1' %}active{% endif %}">
            <i class="fas fa-building icon-left"></i> Company Info
        </a>

        <a href="{% url 'employer_profile:employer_profile_setup_step2' %}" class="step-link {% if request.resolver_match.url_name == 'employer_profile_setup_step2' %}active{% endif %}">
            <i class="fas fa-info-circle icon-left"></i> Founding Info
        </a>

        <a href="{% url 'employer_profile:employer_profile_setup_step3' %}" class="step-link {% if request.resolver_match.url_name == 'employer_profile_setup_step3' %}active{% endif %}">
            <i class="fas fa-envelope icon-left"></i> Contact
        </a>
    </section>
</div>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-section-card">
            <h2>Username</h2>
            <div class="field-container">
                <input type="text" value="{{ user.username }}" class="form-control" readonly style="background-color: #f0f0f0; cursor: not-allowed;">
                <small class="form-text text-muted">Username cannot be changed</small>
            </div>
        </div>
        <hr>
        <div class="form-section-card">
            <h2>Logo & Business Permit</h2>
            <div class="upload-group-row">
                <div class="upload-column">
                    <h3 class="upload-column-title">Company Logo</h3>
                    <div class="logo-upload-wrapper">
                        {% if form.instance.company_profile_image %}
                        <div class="image-preview-setup has-image square-logo-area" id="logo-preview">
                            <img src="{{ form.instance.company_profile_image.url }}" alt="Company Logo">
                            <div class="hover-overlay-setup">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><span>Change photo</span> or drop here</p>
                                <small>Max photo size 5 MB</small>
                            </div>
                        </div>
                        {% else %}
                        <div class="image-preview-setup square-logo-area" id="logo-preview">
                            <div class="upload-content-placeholder">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>Browse photo or drop here</h4>
                                <p class="upload-hint">A photo larger than 400 pixels work best. Max photo size 5 Mb.</p>
                            </div>
                        </div>
                        {% endif %}
                        <div style="display: none;">
                            {{ form.company_profile_image }}
                        </div>
                    </div>
                    <div class="error-text" id="logo-error">
                        {% if form.company_profile_image.errors %}{{ form.company_profile_image.errors.0 }}{% endif %}
                    </div>
                </div>
                
                {# RIGHT UPLOAD AREA: Business Permit #}
                <div class="upload-column">
                    <h3 class="upload-column-title">Business Permit</h3>
                    <div class="permit-upload-wrapper">
                        {% if form.instance.company_business_permit %}
                        <div class="image-preview-setup has-image business-permit-area" id="permit-preview" data-existing-url="{{ form.instance.company_business_permit.url }}" data-existing-name="{{ form.instance.company_business_permit.name }}">
                            {% with name=form.instance.company_business_permit.name url=form.instance.company_business_permit.url %}
                                <div class="permit-card">
                                    <div class="permit-card-icon">
                                        {% comment %}Choose icon based on extension{% endcomment %}
                                        {% if name|lower|slice:"-4:" == ".pdf" %}
                                            <i class="fas fa-file-pdf"></i>
                                        {% elif name|lower|slice:"-5:" == ".docx" %}
                                            <i class="fas fa-file-word"></i>
                                        {% elif name|lower|slice:"-4:" == ".png" or name|lower|slice:"-4:" == ".jpg" or name|lower|slice:"-5:" == ".jpeg" %}
                                            <i class="fas fa-file-image"></i>
                                        {% else %}
                                            <i class="fas fa-file"></i>
                                        {% endif %}
                                    </div>
                                    <div class="permit-card-body">
                                        <div class="permit-filename">{{ name }}</div>
                                        <div class="permit-meta">Uploaded file</div>
                                    </div>
                                    <div class="permit-card-actions">
                                        <a href="{{ url }}" target="_blank" class="btn btn-sm">View</a>
                                        <button type="button" class="btn btn-sm btn-danger permit-remove-btn" aria-label="Remove business permit">&times;</button>
                                    </div>
                                </div>
                            {% endwith %}
                        </div>
                        {% else %}
                        <div class="image-preview-setup business-permit-area" id="permit-preview">
                            <div class="upload-content-placeholder">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>Browse photo or drop here</h4>
                                <p class="upload-hint">Supported formats: PNG, JPG, PDF, DOCX. Max file size 5 MB.</p>
                            </div>
                        </div>
                        {% endif %}
                        <div style="display: none;">
                            {{ form.company_business_permit }}
                        </div>
                    </div>
                    <div class="error-text" id="business-permit-error">
                        {% if form.company_business_permit.errors %}{{ form.company_business_permit.errors.0 }}{% endif %}
                    </div>
                </div>
            </div>
            
        </div>
        <hr>
        <div class="form-section-card">
            <h2>Company name</h2>
            <div class="field-container">
                {{ form.company_name }}
                <div class="error-text" id="company-name-error">
                    {% if form.company_name.errors %}{{ form.company_name.errors.0 }}{% endif %}
                </div>
            </div>
            <h2>About Us</h2>
            <div class="field-container">
                {{ form.about_us }}
                <div id="about-us-editor" class="form-control" contenteditable="true" 
                    data-linked-input="#{{ form.about_us.id_for_label }}">
                    Write down about your company here. Let the candidate know who we are...
                </div>
               <div class="rich-text-toolbar">
                    <button type="button" data-command="bold">B</button>
                    <button type="button" data-command="italic">I</button>
                    <button type="button" data-command="underline">U</button>
                    <button type="button" data-command="strikeThrough"><i class="fas fa-s"></i></button>
                    <button type="button" data-command="createLink"><i class="fas fa-link"></i></button> 
                    
                    {# List Commands #}
                    <button type="button" data-command="insertUnorderedList"><i class="fas fa-list-ul"></i></button>
                    <button type="button" data-command="insertOrderedList"><i class="fas fa-list-ol"></i></button>

                    {# --- NEW INDENTATION BUTTONS --- #}
                    <button type="button" data-command="indent"><i class="fas fa-indent"></i></button>
                    <button type="button" data-command="outdent"><i class="fas fa-outdent"></i></button>
                    {# --------------------------------- #}
                </div>
                {% if form.about_us.errors %}<div class="error-text">{{ form.about_us.errors }}</div>{% endif %}
            </div>
        </div>

        <div class="form-navigation-row">
            <button type="submit" class="cta-btn save-next-btn" id="submit">Save & Next &rarr;</button>
        </div>
    </form>
</main>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/profile_setup/employer_profile_create.js' %}"></script>
{% endblock %}